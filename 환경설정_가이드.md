# 🔧 COZY 커피 주문 시스템 - 환경 설정 및 테스트 가이드

## 📋 현재 상황

### ✅ 완료된 작업
1. **Git 배포 완료** ✅
   - 커밋: `e144fe6`
   - 푸시: 원격 저장소에 업로드 완료
   - 추가된 파일:
     - `test-functions.js` - 전체 기능 테스트 스크립트
     - `quick-fix-test.js` - 빠른 진단 도구
     - `check-env.js` - 환경 변수 확인 도구
     - `diagnostic-report.md` - 진단 보고서
     - `테스트_결과_요약.md` - 테스트 결과 요약

2. **서버 상태** ✅
   - 포트 3000에서 정상 실행 중
   - API 엔드포인트 응답 정상

### ❌ 해결 필요한 문제

**데이터베이스 연결 실패**
```
password authentication failed for user "postgres"
```

**원인:**
- Render 클라우드 DB를 사용하려 하지만 인증 정보가 잘못됨
- 현재: `DB_USER=postgres`, `DB_NAME=coffee_order_db` ❌
- 필요: `DB_USER=order_app_db_asrw_user`, `DB_NAME=order_app_db_asrw` ✅

---

## 🔧 데이터베이스 연결 수정 방법

### 방법 1: DATABASE_URL 사용 (가장 간단) ⭐

**1단계:** Render Dashboard에서 Database URL 확인
- Render.com 접속
- PostgreSQL 데이터베이스 선택
- "Info" 탭 클릭
- "External Database URL" 복사

**2단계:** `server/.env` 파일 수정
```env
# 복사한 URL을 아래에 붙여넣기
DATABASE_URL=postgresql://order_app_db_asrw_user:비밀번호@dpg-d41atm75r7bs739b60o0-a.oregon-postgres.render.com/order_app_db_asrw

# 기존 설정은 주석 처리하거나 삭제
# DB_HOST=...
# DB_PORT=...
# DB_NAME=...
# DB_USER=...
# DB_PASSWORD=...

PORT=3000
NODE_ENV=development
FRONTEND_URL=http://localhost:5173
```

---

### 방법 2: 개별 환경 변수 수정

`server/.env` 파일을 다음과 같이 수정:

```env
DB_HOST=dpg-d41atm75r7bs739b60o0-a.oregon-postgres.render.com
DB_PORT=5432
DB_NAME=order_app_db_asrw
DB_USER=order_app_db_asrw_user
DB_PASSWORD=실제_비밀번호_입력
DB_SSL=true

PORT=3000
NODE_ENV=development
FRONTEND_URL=http://localhost:5173
```

**비밀번호 확인:** Render Dashboard → Info 탭에서 확인

---

### 방법 3: 로컬 PostgreSQL 설치 및 사용

**PostgreSQL 설치 필요:**
1. https://www.postgresql.org/download/windows/ 에서 다운로드
2. 설치 후 `server/.env` 수정:

```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=coffee_order_db
DB_USER=postgres
DB_PASSWORD=설치_시_입력한_비밀번호
DB_SSL=false

PORT=3000
NODE_ENV=development
FRONTEND_URL=http://localhost:5173
```

---

## 🚀 수정 후 실행 순서

### 1단계: 환경 변수 확인
```bash
node check-env.js
```

### 2단계: 데이터베이스 초기화
```bash
cd server
npm run init-db
```

**예상 출력:**
```
✅ 데이터베이스에 연결되었습니다
✅ 테이블 생성 완료
✅ 초기 데이터 삽입 완료

📋 메뉴 목록:
   1. 아메리카노(ICE) - 4000원 (재고: 10개)
   2. 아메리카노(HOT) - 4000원 (재고: 10개)
   3. 카페라떼 - 5000원 (재고: 10개)
```

### 3단계: 서버 재시작
현재 실행 중인 서버를 중지하고 (Ctrl+C):
```bash
cd server
npm run dev
```

### 4단계: 기능 테스트 실행
새 터미널에서:
```bash
node test-functions.js
```

---

## 🧪 테스트 항목

기능 테스트 스크립트는 다음을 자동으로 테스트합니다:

### 1. 기본 연결 테스트
- [x] 서버 연결 확인
- [ ] 데이터베이스 연결 확인

### 2. 메뉴 관리
- [ ] 메뉴 목록 조회
- [ ] 특정 메뉴 상세 조회

### 3. 주문 기능
- [ ] 주문 생성
- [ ] 주문 조회
- [ ] 재고 자동 감소 확인

### 4. 관리자 기능
- [ ] 대시보드 통계 조회
- [ ] 주문 목록 조회
- [ ] 주문 상태 변경 (pending → accepted → preparing → completed)
- [ ] 재고 조회
- [ ] 재고 증감 (+/-)

---

## 📊 진단 도구 사용법

### 빠른 진단
```bash
node quick-fix-test.js
```
현재 설정 상태와 문제점을 빠르게 확인합니다.

### 환경 변수 확인
```bash
node check-env.js
```
.env 파일의 설정을 확인합니다.

### 전체 기능 테스트
```bash
node test-functions.js
```
모든 API 엔드포인트를 자동으로 테스트합니다.

---

## 📝 예제: .env 파일 (Render 사용 시)

`server/.env` 파일 내용 예시:

```env
DATABASE_URL=postgresql://order_app_db_asrw_user:XSEmgZfWZIr4jEu0JU0SjmuzkyNZY6lZ@dpg-d41atm75r7bs739b60o0-a.oregon-postgres.render.com/order_app_db_asrw

PORT=3000
NODE_ENV=development
FRONTEND_URL=http://localhost:5173
```

**주의:** 위의 비밀번호는 예시이며, 실제 Render 비밀번호로 교체해야 합니다.

---

## 🎯 다음 단계 요약

1. **지금 바로:** `server/.env` 파일 수정 (위의 방법 1, 2, 3 중 선택)
2. **그 다음:** `cd server && npm run init-db` 실행
3. **서버 재시작:** `cd server && npm run dev`
4. **테스트 실행:** `node test-functions.js`

---

## 💡 추가 참고 자료

| 파일 | 설명 |
|------|------|
| `server/.env.example` | 환경 변수 예시 파일 (지금 생성됨) |
| `server/ENV_GUIDE.md` | 상세한 환경 변수 가이드 |
| `테스트_결과_요약.md` | 테스트 결과 및 문제 해결 방법 |
| `diagnostic-report.md` | 진단 보고서 (영문) |

---

## 🆘 문제 해결

### 여전히 연결 실패 시:
1. Render Dashboard에서 데이터베이스 상태 확인
2. 비밀번호가 정확한지 재확인
3. 방화벽 설정 확인
4. Render 데이터베이스가 실행 중인지 확인

### PostgreSQL 설치가 필요한 경우:
- Windows: https://www.postgresql.org/download/windows/
- 설치 시 비밀번호를 기억해두세요
- 설치 후 .env에 로컬 설정 사용

---

📞 **지원:** 문제가 계속되면 Render 지원팀에 문의하거나, PostgreSQL 로컬 설치를 고려하세요.

